<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/templateBase :: common_head_title_meta_links(~{::title},~{::meta},~{::links})}">
    <title th:fragment="title">Blog | Riflessioni su Vita, Scienza e Spirito</title>
    <th:block th:fragment="meta">
        <meta name="description" content="Un blog di riflessione dedicato a psicologia, filosofia, scienza, tecnologia, spiritualità e visione della società. Approfondisci temi di famiglia, mente e futuro." />
        <meta name="keywords" content="psicologia, filosofia, scienza, tecnologia, famiglia, spiritualità, società, riflessioni, visione del mondo, idee, cultura, progresso" />
        <meta property="og:title" content="Blog | Riflessioni su Vita, Scienza e Spirito" />
        <meta property="og:description" content="Esplora le connessioni tra psicologia, filosofia, scienza e spiritualità. Scopri approfondimenti su famiglia, società e tecnologia in un dialogo tra mente e spirito." />
        <meta property="og:image" content="https://www.lunasapiens.com/logo_400x300.png" />
        <meta property="og:image:secure_url" content="https://www.lunasapiens.com/logo_400x300.png" />
        <meta property="og:image:type" content="image/png" />
        <meta property="og:image:width" content="400" />
        <meta property="og:image:height" content="300" />
        <meta property="og:image:alt" content="Luna Sapiens" />
        <meta property="og:url" content="https://www.lunasapiens.com/blog" />
        <meta property="og:type" content="website" />
        <meta name="twitter:card" content="summary" />
        <meta name="twitter:title" content="Blog | Riflessioni su Vita, Scienza e Spirito" />
        <meta name="twitter:description" content="Un blog che riflette su temi fondamentali: mente, spirito, società, scienza, famiglia e futuro tecnologico." />
        <meta name="twitter:image" content="https://www.lunasapiens.com/logo_400x300.png" />
    </th:block>
    <th:block th:fragment="links">
        <link rel="canonical" href="https://www.lunasapiens.com/blog" />
        <link rel="stylesheet" href="/css/style.css?v=0.1">
        <link rel="stylesheet" href="/css/articles.css?v=0.1">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

    </th:block>
</head>
<body>
<header th:replace="~{fragments/templateBase :: header}"></header>

<div class="container mt-4">


    <!-- Campo di ricerca sematica -->
    <div class="mb-3">
        <form method="get" th:action="@{/blog}" onsubmit="showLoadingOverlay()">
            <div class="input-group">
                <input type="text" name="search" class="form-control"
                       placeholder="Cerca negli articoli (ricerca semantica)..."
                       th:value="${search != null} ? ${search} : ''">
                <button type="submit" class="btn btn-primary">Cerca</button>
                <a th:href="@{/blog}" class="btn btn-secondary">Resetta</a>
            </div>
        </form>
    </div>


    <!-- Sezione per visualizzare gli articoli -->
    <div class="mt-5">
        <div th:if="${articlePage.isEmpty()}">
            <p>Nessun articolo trovato.</p>
        </div>

        <div th:each="article : ${articlePage.content}">
            <div class="card mb-3">
                <div class="card-body">
                    <!-- Riga con ID articolo e data -->
                    <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="text-muted">
                    <i class="bi bi-hash me-1"></i>
                    Articolo <span th:text="${article.id}"></span>
                </span>
                        <span class="text-muted">
                    <i class="bi bi-calendar-event me-1"></i>
                    <span th:text="${#temporals.format(article.createdAt, 'dd/MM/yyyy HH:mm')}"></span>
                </span>
                    </div>

                    <!-- Contenuto articolo -->
                    <div class="card-text collapsible-text" th:utext="${article.content}"></div>
                    <button class="btn btn-link btn-sm toggle-button">Leggi tutto</button>
                </div>
            </div>
        </div>


        <!-- PAGINAZIONE solo se non è ricerca semantica -->
        <div th:if="${hideSearch != true}"
             th:replace="~{fragments/templateBase :: paginationArticles('/blog')}"></div>


    </div>

</div> <!-- fine container -->
<div th:replace="~{fragments/templateBase :: loadingOverlay}"></div>
<footer th:replace="~{fragments/templateBase :: footer}"></footer>
<div th:replace="~{fragments/templateBase :: link-js-util-bootstrap}"></div>


<script>

    document.addEventListener("DOMContentLoaded", function () {
        const toggleButtons = document.querySelectorAll(".toggle-button");

        toggleButtons.forEach(function (button) {
            const content = button.previousElementSibling;

            // Calcola altezza di una riga usando line-height
            const style = getComputedStyle(content);
            const lineHeight = parseFloat(style.lineHeight);

            // Numero massimo di righe visibili (20 righe come nel CSS)
            const maxLines = 20;
            const maxHeight = lineHeight * maxLines;

            // Altezza reale del contenuto
            const actualHeight = content.scrollHeight;

            if (actualHeight <= maxHeight) {
                // Nascondi il pulsante se il contenuto non supera il limite
                button.style.display = "none";
            } else {
                // Mostra il pulsante e aggiungi la logica toggle
                button.style.display = "inline-block";
                button.addEventListener("click", function () {
                    content.classList.toggle("expanded");
                    button.textContent = content.classList.contains("expanded") ? "Leggi meno" : "Leggi tutto";
                });
            }
        });
    });
</script>


</body>
</html>