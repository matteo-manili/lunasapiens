<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/templateBase :: common_head_title_meta_links_scripts(~{::title},~{::meta},~{::links},~{::scripts})}">
    <title th:fragment="title">Luna Sapiens | Iscrizione Utente</title>
    <th:block th:fragment="meta">
        <meta name="description" content="Iscriviti su LunaSapiens.com per accedere a vantaggi esclusivi come il chatbot. Ricevi un link di accesso valido per 7 giorni, senza necessità di password.">
        <meta name="keywords" content="iscrizione, tema natale, chatbot, psicologo, accesso gratuito, LunaSapiens">
    </th:block>
    <th:block th:fragment="links">
        <link rel="canonical" href="https://www.lunasapiens.com/register" />
        <link rel="stylesheet" href="/css/style.css">
    </th:block>
    <th:block th:fragment="scripts">
        <script src="https://www.google.com/recaptcha/api.js"></script>
    </th:block>
</head>
<body>
<header th:replace="~{fragments/templateBase :: header}"></header>
<div class="container mt-4">

    <h1 class="mb-4 text-center">Iscriviti a Luna Sapiens</h1>

    <div th:replace="~{fragments/templateBase :: message_alerts}"></div>

    <div class="bg-light rounded-3 text-center shadow-sm mb-4 mt-4 pt-3">
        <h5 class="mb-4">Ricevi il tuo link di accesso</h5>
        <p>
            Inserisci la tua email e riceverai un <strong>link speciale</strong> che ti permetterà di accedere al servizio come utente registrato.<br>
            Una volta aperto il link, sarai iscritto automaticamente e potrai subito usare tutti i vantaggi riservati agli utenti.<br>
            Il link è valido per <span th:text="${JWT_EXPIRED_TOKEN_DAY_OF_YEAR}"></span> giorni, dopodiché potrai richiederne uno nuovo.<br>
            Tutto il progetto è <strong>gratuito</strong> e semplice da usare.
        </p>
        <form id="register-submit" th:action="@{/registrazioneUtente}" method="post" class="row g-2 justify-content-center" onsubmit="showLoadingOverlay()">
            <div class="col-12 col-md-8 col-lg-6 mb-3">
                <input type="email" id="email" name="email" class="form-control" placeholder="Indirizzo Email" aria-label="Indirizzo Email" required>
            </div>


            <!-- OLD
            <div class="col-12 col-md-4 col-lg-3">
                <button type="submit" id="subscribe-button" class="btn btn-primary w-100">Invia link</button>
            </div> -->

            <!-- NEW -->
            <div class="col-12 col-md-4 col-lg-3">

                <button class="g-recaptcha btn btn-primary w-100"
                        id="subscribe-button"
                        data-sitekey="6Ld0P8YqAAAAAMkoHnykcf5Yjy2UtyTHKXIiDnlR"
                        data-callback="onSubmit"
                        data-action="submit">Invia link</button>




            </div>

        </form>
    </div>

    <div class="alert alert-success mt-3" role="alert">
        <p><b>Vantaggi dell'iscrizione:</b></p>
        <ul>
            <li>Fino a <span th:text="${MAX_MESSAGES_PER_DAY_UTENTE}"></span> domande al giorno con la <a href="/psicologo">Chat Psicologo IA</a>.</li>
        </ul>
        <p><b>Se non ti iscrivi, potrai comunque:</b></p>
        <ul>
            <li>Fare fino a <span th:text="${MAX_MESSAGES_PER_DAY_ANONYMOUS}"></span> domande al giorno con la <a href="/psicologo">Chat Psicologo IA</a>.</li>
        </ul>
    </div>
</div>

<div th:replace="~{fragments/templateBase :: loadingOverlay}"></div>
<footer th:replace="~{fragments/templateBase :: footer}"></footer>
<div th:replace="~{fragments/templateBase :: link-js-util-bootstrap}"></div>

<script>

    /*
    document.addEventListener("DOMContentLoaded", function() {
        loadData();
        function loadData() {
            const email = localStorage.getItem('email');
            // Imposta i valori sugli input
            document.getElementById('email').value = email || "";
        }

        // Ottieni il modulo
        const form = document.getElementById('register-submit');
        // Aggiungi un event listener per l'evento submit
        form.addEventListener('submit', function(event) {
            // Prevenire l'invio del modulo se necessario
            event.preventDefault();
            // Ottieni il valore dell'input email
            const emailInput = document.getElementById('email');
            const email = emailInput.value;

            // Salva il valore nel localStorage
            localStorage.setItem('email', email);

            googleTrackFormSubmit('register-submit');

            // Esegui il submit del modulo
            form.submit();
        });
    });
*/



    // Quando la pagina è pronta, ricarica l'email salvata
    document.addEventListener("DOMContentLoaded", function() {

        const savedEmail = localStorage.getItem('email');
        if (savedEmail) {
            document.getElementById('email').value = savedEmail;
        }

    });




    // Funzione richiesta da reCAPTCHA: qui si esegue il submit reale del form
    function onSubmit(token) {

        // Mostra overlay di caricamento
        if (typeof showLoadingOverlay === "function") {
            showLoadingOverlay();
        }

        // Salva l'email nel localStorage
        const email = document.getElementById('email').value;
        localStorage.setItem('email', email);

        // Tracking opzionale
        if (typeof googleTrackFormSubmit === "function") {
            googleTrackFormSubmit('register-submit');
        }

        // Esegue l'invio del form
        document.getElementById("register-submit").submit();
    }
</script>


</body>
</html>
